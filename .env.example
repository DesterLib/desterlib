# ============================================
# DesterLib Environment Configuration
# ============================================
# Copy this file to .env and fill in your values
# All services (API, Scanner, Metadata) read from apps/api/.env
# ============================================

# ============================================
# REQUIRED - Database Configuration
# ============================================
# PostgreSQL connection string (REQUIRED for all services)
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/desterlib_test

# ============================================
# REQUIRED - Storage Paths
# ============================================
# Path to metadata storage directory (REQUIRED)
# Directory where metadata images (posters, backdrops) are stored
# This path is shared between API and metadata-service
# Examples:
#   - Absolute: /Volumes/External/Projects/Dester/desterlib/desterlib-data/metadata
#   - Relative: ./desterlib-data/metadata
METADATA_PATH=./desterlib-data/metadata

# Path to API logs directory (REQUIRED)
# Directory where API log files are stored (e.g., combined.log)
# Examples:
#   - Absolute: /Volumes/External/Projects/Dester/desterlib/desterlib-data/logs
#   - Relative: ./desterlib-data/logs
API_LOG_PATH=./desterlib-data/logs

# Path to scan job failure logs directory (REQUIRED for metadata-service)
# Directory where metadata-service stores scan job failure logs
# Examples:
#   - Absolute: /Volumes/External/Projects/Dester/desterlib/desterlib-data/logs/scan-jobs
#   - Relative: ./desterlib-data/logs/scan-jobs
SCAN_JOB_LOG_PATH=./desterlib-data/logs/scan-jobs

# ============================================
# API Service Configuration
# ============================================
# API server port (default: 3001)
PORT=3001

# Node environment: development, production, test
NODE_ENV=development

# Enable Prisma query logging (default: false)
# Set to "true" to enable detailed database query logs
PRISMA_LOG=false

# ============================================
# Redis Configuration (Optional)
# ============================================
# Redis connection URL for queues and caching
# All services can run without Redis, but metadata queueing will be disabled
# Format: redis://host:port/db
REDIS_URL=redis://localhost:6379

# ============================================
# Service URLs (Optional)
# ============================================
# Scanner service URL (default: http://localhost:8080)
SCANNER_SERVICE_URL=http://localhost:8080

# Metadata service URL (default: http://localhost:8082)
METADATA_SERVICE_URL=http://localhost:8082

# ============================================
# API Rate Limiting (Optional)
# ============================================
# Rate limit window in milliseconds (default: 900000 = 15 minutes)
RATE_LIMIT_WINDOW_MS=900000

# Maximum requests per window (default: 100)
RATE_LIMIT_MAX=100

# ============================================
# Docker Path Mapping (Optional)
# ============================================
# Host media path (for Docker volume mapping)
# Default: /Volumes/External/Library/Media
HOST_MEDIA_PATH=/Volumes/External/Library/Media

# Container media path (inside Docker container)
# Default: /media
CONTAINER_MEDIA_PATH=/media

# Path to check if running in Docker (default: /media)
DOCKER_CHECK_PATH=/media

# ============================================
# Scanner Service Configuration (Optional)
# ============================================
# Scanner service port (default: 8080)
SCANNER_PORT=8080

# Number of concurrent workers for file processing (default: 10)
SCANNER_WORKER_COUNT=10

# Maximum directory depth for scanning (default: 4)
SCANNER_MAX_DEPTH=4

# Path to ffprobe executable (default: ffprobe)
# Should be in PATH or provide full path
FFPROBE_PATH=ffprobe

# Redis queue name for metadata jobs (default: metadata:jobs)
SCAN_QUEUE_NAME=metadata:jobs

# ============================================
# Metadata Service Configuration (Optional)
# ============================================
# Metadata service port (default: 8082)
METADATA_PORT=8082

# Maximum concurrent metadata jobs (default: 4)
METADATA_MAX_CONCURRENT=4

# Rate limit for metadata API requests per second (default: 4)
# TMDB API limit is 40 requests per 10 seconds (4 req/sec)
METADATA_RATE_LIMIT_RPS=4

# Redis queue name for metadata jobs (default: metadata:jobs)
METADATA_QUEUE_NAME=metadata:jobs

# ============================================
# Notes
# ============================================
# 1. DATABASE_URL is REQUIRED - all services will fail to start without it
# 2. METADATA_PATH is REQUIRED - API and metadata-service will fail without it
# 3. API_LOG_PATH is REQUIRED - API will fail without it
# 4. SCAN_JOB_LOG_PATH is REQUIRED - metadata-service will fail without it
# 5. Redis is OPTIONAL - services will run in degraded mode without it
# 6. All other variables have sensible defaults
# 7. For production, set NODE_ENV=production
# 8. TMDB API key is managed via the Settings API, not environment variables
# 9. See documentation for more details: https://docs.dester.app
